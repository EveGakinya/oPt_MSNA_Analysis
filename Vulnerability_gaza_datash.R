library(readr)
library(dplyr)
dap <- analysisplan
dap <- dap %>% dplyr::select("Indicator.Group...Sector","research.question", "sub.research.question",dependent.variable)
dap <- dap %>% dplyr::rename("dependent.var" = "dependent.variable")
results <- read_csv("Output/raw_results/raw_results_oPt_vulnerability_strata_30012022_conditions_filtered.csv")
results_gaza <- results %>% dplyr::select(dependent.var, numbers,repeat.var,repeat.var.value) %>% 
  dplyr::filter(repeat.var.value == "abasan_jadida"| repeat.var.value == "abasan_kabira"| repeat.var.value == "al_bureij"| repeat.var.value == "al_fukhari"|
           repeat.var.value == "al_maghazi" | repeat.var.value == "al_mughraqa" | repeat.var.value == "al_musaddar" | repeat.var.value == "al_qarara"
         | repeat.var.value == "an_naser" | repeat.var.value == "an_nuseirat" | repeat.var.value == "ash_shoka" | repeat.var.value == "az_zawayda" 
         | repeat.var.value == "bani_suheila"| repeat.var.value == "beit_hanun"| repeat.var.value == "beit_lahiya"| repeat.var.value == "bureij_camp"
         | repeat.var.value == "deir_balah"| repeat.var.value == "deir_balah_camp"| repeat.var.value == "gaza"| repeat.var.value == "jabalya"
         | repeat.var.value == "jabalya_camp"| repeat.var.value == "juhor_deik"| repeat.var.value == "khan_yunis"| repeat.var.value == "khan_yunis_camp"
         | repeat.var.value == "khuza"| repeat.var.value == "madinat_ezahra"| repeat.var.value == "maghazi_camp"| repeat.var.value == "nuseirat_camp"
         | repeat.var.value == "rafah"| repeat.var.value == "rafah_camp"| repeat.var.value == "shati_camp"| repeat.var.value == "umm_naser" | repeat.var.value == "wadi_salqa")

df_gaza <- merge(x = results_gaza, y= dap , by = "dependent.var", all.x = TRUE)

df_gaza <- df_gaza %>% 
  dplyr::mutate(Percent = round(numbers *100,0))

df_gaza$Percent_groups <- case_when(
  df_gaza$Percent >= 0 & df_gaza$Percent < 10~ "0% - 9%",
  df_gaza$Percent >= 10 & df_gaza$Percent < 20 ~ "10% - 19%",
  df_gaza$Percent >= 20 & df_gaza$Percent < 30 ~ "20% - 29%",
  df_gaza$Percent >= 30 & df_gaza$Percent < 40 ~ "30% - 39%",
  df_gaza$Percent >= 40 & df_gaza$Percent < 50 ~ "40% - 49%",
  df_gaza$Percent >= 50 & df_gaza$Percent < 60 ~ "50% - 59%",
  df_gaza$Percent >= 60 & df_gaza$Percent < 70 ~ "60% - 69%",
  df_gaza$Percent >= 70 & df_gaza$Percent < 80 ~ "70% - 79%",
  df_gaza$Percent >= 80 & df_gaza$Percent < 90 ~ "80% - 89%",
  df_gaza$Percent >= 90 & df_gaza$Percent <= 100 ~ "90% - 100%")



df_gaza[df_gaza == "WASH Vulnerabilities"] <- "Water, Sanitation & Hygiene Vulnerability"

df_gaza[df_gaza == "Health Vulnerabilities"] <- "Health Vulnerability"

df_gaza[df_gaza == "Protection Vulnerabilities"] <- "Protection Vulnerability"



df_gaza <- df_gaza %>% dplyr::rename("Indicator Group / Sector" = "Indicator.Group...Sector")

# df_gaza <- df_gaza %>% dplyr::filter(`Indicator Group / Sector` != "NA")

df_gaza <- df_gaza %>% dplyr::rename("Sector" = "Indicator Group / Sector")

# df_gaza <- df_gaza %>% dplyr::rename("Indicator" = "research.question")

df_gaza <- df_gaza %>% dplyr::rename("Indicator" = "sub.research.question")

library(readxl)
Population_groups <- read_excel("Output/raw_results/dap_population_groups.xlsx")


Population_groups <- Population_groups %>% dplyr::rename("dependent.var" = "dependent.variable")

Population_groups<- Population_groups %>%  dplyr::select("dependent.var","Population Reference")

df_gaza_new <- merge(x = df_gaza, y= Population_groups , by = "dependent.var", all.x = TRUE)



df_gaza_new <- df_gaza_new %>% 
  dplyr::mutate(repeat.var.value = ifelse(repeat.var.value == "abasan_jadida", "'Abasan al Jadida (as Saghira)", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "abasan_kabira", "'Abasan al Kabira", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "al_bureij", "Al Bureij", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "al_fukhari", "Al Fukhkhari", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "al_maghazi", "Al Maghazi", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "al_mughraqa", "Al Mughraqa", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "al_musaddar", "Al Musaddar", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "al_qarara", "Al Qarara", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "an_naser", "An Naser", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "an_nuseirat", "An Nuseirat", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "ash_shoka", "Shokat as Sufi", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "az_zawayda", "Az Zawayda", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "bani_suheila", "Bani Suheila", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "beit_hanun", "Beit Hanoun", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "beit_lahiya", "Beit Lahiya", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "bureij_camp", "Al Bureij Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "deir_balah", "Deir al Balah", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "deir_balah_camp", "Deir al Balah Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "gaza", "Gaza", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "jabalya", "Jabalya", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "jabalya_camp", "Jabalya Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "juhor_deik", "Juhor ad Dik", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "khan_yunis", "Khan Yunis", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "khan_yunis_camp", "Khan Yunis Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "khuza", "Khuza'a", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "madinat_ezahra", "Madinat Ezahra", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "maghazi_camp", "Al Maghazi Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "nuseirat_camp", "An Nuseirat Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "rafah", "Rafah", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "rafah_camp", "Rafah Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "shati_camp", "Ash Shati' Camp", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "umm_naser", "Umm an Naser", repeat.var.value),
         repeat.var.value = ifelse(repeat.var.value == "wadi_salqa", "Wadi as Salqa", repeat.var.value)
  )

df_gaza_new <- df_gaza_new %>% 
                dplyr::mutate(Governorate = case_when(repeat.var.value %in% c("Al Bureij","Wadi as Salqa", "An Nuseirat","An Nuseirat Camp", "Al Maghazi Camp", "Al Musaddar",
                                                                      "Deir al Balah","Al Maghazi", "Az Zawayda", "Al Bureij Camp","Deir al Balah Camp") ~ "Deir Al-Balah",
                                                       repeat.var.value %in% c("Madinat Ezahra","Gaza","Al Mughraqa","Juhor ad Dik") ~ "Gaza",
                                                       repeat.var.value %in% c("Jabalya","Ash Shati' Camp","Beit Hanoun","Beit Lahiya","Umm an Naser","Jabalya Camp") ~ "North Gaza",
                                                       repeat.var.value %in% c("Shokat as Sufi","An Naser","Rafah","Rafah Camp") ~ "Rafah",
                                                       TRUE ~ "Khan Younis"))

df_gaza_new <- df_gaza_new %>% relocate(Governorate, .after = repeat.var.value)

df_gaza_new <- df_gaza_new %>% dplyr::rename("Area" = "repeat.var.value")

df_gaza_new <- df_gaza_new %>% dplyr::filter(`Sector` != "NA")

name <- "gaza_strata_vul_analysis"
write.csv(df_gaza_new, sprintf("output/raw_results/Results_%s_filtered.csv", name), row.names=F)
